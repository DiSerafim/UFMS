<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M√≥dulo 2 ‚Äì Defini√ß√£o e manipula√ß√£o de dados relacionais.</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>M√≥dulo 2 ‚Äì Defini√ß√£o e manipula√ß√£o de dados relacionais.</h1>
        <h2>üí° Unidade 2 - SQL - Linguagem de manipula√ß√£o de dados.</h2>
        <p>Professor Especialista: Vanessa Borges.</p>
    </header>
    <main>
        <section id="disciplinas">
            <h2>Disciplinas</h2>
            <p></p>
            <ul>
                <li>
                    <p>BANCO DE DADOS-T01-2024-1
                        <span class="status concluida">Conclu√≠do</span>
                    </p>
                </li>
            </ul>
        </section>
        <section id="materiais">
            <h2>Materiais</h2>
            <a href="https://www.youtube.com/watch?v=qxoBxi7LpXk&list=PLxI8Can9yAHeHQr2McJ01e-ANyh3K0Lfq&index=17&ab_channel=UNIVESP" class="btn waves-effect waves-light" target="_blank" type="button" name="action">
                V√≠deo 3 - 
                Bancos de Dados - Aula 16 - Linguagem de consulta ‚Äì SQL Parte IV. 
                <i class="material-icons right"> send</i>
            </a>
            <p>Professor ministrante: Sarajane Marques Peres.</p>
        </section>
        <section>
            <h2>Conte√∫do</h2>
            <h3>Linguagem de consulta ‚Äì SQL.</h3>
        </section>

        <section>
            <h2>SQL.</h2>
            <p>
                Esquema para o modelo Relacional do contexto did√°tico: EMPRESA.</p>
            <pre>
                FUNCIONARIO (<b>ident</b>, nome, sobrenome, endereco, dtnasc, salario, sexo, supident, dnumero)
                DEPENDENTE(<b>fident</b>, <b>nome</b>, dt_nasc, sexo, relacionamento)
                DEPARTAMENTO(<b>numero</b>, nome, gident, dtinicio)
                LOCALIZACOES(<b>dnumero</b>, <b>localizacao</b>)
                PROJETO(<b>numero</b>, nome, localizacao, dnumero)
                TRABALHA_EM(<b>pnumero</b>, <b>fident</b>, horas)
            </pre>
            <p>Algumas simplifica√ß√µes nos nomes de vari√°veis foram realizadas para facilitar o uso delas nas consultas. A chave prim√°ria, em cada rela√ß√£o, est√° sublinhada.</p>

            <b>SQL-Structured Query Language:</b>
            <ul>
                <li>Linguagem de banco de dados com recursos para defini√ß√£o de dados, consulta aos dados e atualiza√ß√£o de dados.</li>
                <li>Permite especificar restri√ß√µes que devem ser impostas aos dados possibilitando a implementa√ß√£o da integridade e seguran√ßa da informa√ß√£o armazenada.</li>
            </ul>
            <p>SQL √© uma linguagem padr√£o para SGBDs comerciais. H√° um padr√£o, estabelecido pelo American National Standards Institute (ANSI) e pela International Standards Organization (ISO).</p>
            <ul>
                <li>Sugest√µes de consulta para implementa√ß√µes comerciais:</li>
                <ul>
                    <li>https://www.postgresql.org/docs/9.0/static/sql.html</li>
                    <li>https://www.postgresql.org/docs/9.0/static/bookindex.html</li>
                    <li>http://dev.mysql.com/doc/refman/5.7/en/sql-syntax.html</li>
                    <li>http://dev.mysql.com/doc/refman/5.7/en/literals.html</li>
                </ul>
            </ul>
        </section>

        <section>
            <h2>Recursos avan√ßados de SQL.</h2>
            <ul>
                <li>Asser√ß√µes.</li>
                <li>Regras ativas(gatilhos).</li>
                <li>Vis√µes.</li>
            </ul>
            <p>Cada SGBD disponibiliza formas diferentes de implementar restri√ß√µes usando SQL.</p>
            <ul>
                <li>Para implementa√ß√£o de restri√ß√µes que n√£o s√£o poss√≠veis considerando apenas o modelo de dados, h√° algumas op√ß√µes:</li>
                <ul>
                    <li>usar recursos da linguagem de programa√ß√£o escolhida para implementar a aplica√ß√£o que acessar√° o banco de dados, ou de outros aplicativos de constru√ß√£o de sistemas;</li>
                    <li>usar a linguagem de programa√ß√£o de prop√≥sito geral que est√° dispon√≠vel no SGBD;</li>
                    <li>usar recursos avan√ßados de SQL;</li>
                    <li>combinar os recursos das op√ß√µes supracitadas.</li>
                </ul>
            </ul>
            <b>Asser√ß√µes:</b>
            <ul>
                <li>Especifica√ß√µes em SQL que permitem implementar uma regra via uma declara√ß√£o em DDL.</li>
            </ul>
            <p>Envolve a especifica√ß√£o de regras do tipo CHECK que podem atuar em v√°rias rela√ß√µes.</p>
            <p>Modelo:</p>
            <pre>
                CREATE ASSERTION NOME_RESTRICAO
                CHECK (NOT EXISTS (...));
            </pre>
            <p>Se o NOT EXISTS √© <b>FALSO</b>, ent√£o a restri√ß√£o da asser√ß√£o foi violada !!! O banco de dados estaria em um estado inconsistente em rela√ß√£o √†s restri√ß√µes do mundo modelado.</p>
            <b>* Exemplo:</b>
            <p><b>Restri√ß√£o</b>: o sal√°rio de um funcion√°rio n√£o pode ser maior do que o sal√°rio do gerente do departamento para o qual o funcion√°rio trabalha.</p>
            <pre>
                CREATE ASSERTION RESTRICAO_SALARIO
                CHECK (NOT EXISTS (SELECT *
                                FROM FUNCIONARIO AS F,
                                     FUNCIONARIO AS G,
                                     DEPARTAMENTO AS D 
                                WHERE F.dnumero = D.numero 
                                    AND D.Gident = G.ident
                                    AND F.salario > G.salario
                                )
                       );
            </pre>

            <b>Regras ativas (gatilhos):</b>
            <ul>
                <li>Especifica√ß√µes em SQL que permitem implementar a√ß√µes que s√£o executadas quando determinados eventos ocorrem e quando determinadas condi√ß√µes s√£o satisfeitas.</li>
            </ul>
        </section>

        <section>
            <h2>Modelo Evento-Condi√ß√£o-A√ß√£o</h2>
            <b>Evento:</b>
            <ul>
                <li>Geralmente opera√ß√µes de altera√ß√£o aplicadas ao banco de dados (insert, update, delete).</li>
                <p><b>BEFORE</b> - significa que o gatilho dever√° ser executado antes do evento ter efeito no banco de dados.</p>
                <p><b>AFTER</b> - significa que o gatilho dever√° ser executado depois do evento ter efeito no banco de dados.</p>
            </ul>
            <p><b>Condi√ß√£o</b>:</p>
            <ul>
                <li>Determina se a regra especificada na <b>a√ß√£o</b> deveria ser executada a partir da verifica√ß√£o de uma condi√ß√£o. Se nenhuma condi√ß√£o √© especificada, a <b>a√ß√£o</b> ser√° executada de acordo com a ocorr√™ncia do <b>evento</b>.</li>
            </ul>
            <p><b>A√ß√£o</b>:</p>
            <ul>
                <li>A a√ß√£o √© uma sequ√™ncia de declara√ß√µes em SQL, transa√ß√µes de banco de dados ou chamadas a fun√ß√µes implementadas no SGBD ou fora dele.</li>
            </ul>
            <b>* Exemplo:</b>
            <p><b>Gatilho</b>: Sempre que o sal√°rio de um funcion√°rio √© maior do que o sal√°rio de seu supervisor direto, o supervisor precisa ser avisado.</p>
            <pre>
                CREATE TRIGGER VIOLACAO_SALARIO
                BEFORE INSERT OR UPDATE OF salario, supident ON
                                            FUNCIONARIO
                FOR EACH ROW
                WHEN (NEW.salario > (SELECT salario
                                    FROM FUNCIONARIO
                                    WHERE ident = NEW.supident))
                INFORM_SUPERVISOR (NEW.Supident, NEW.ident);
            </pre>
            <img src="img/gatilho.png" alt="gatilho.png">
            <p></p>
            <b>Vis√µes (ou views):</b>
            <ul>
                <li>Uma tabela √∫nica (geralmente virtual e tempor√°ria) derivada de outras tabelas.</li>
                <li>Tabela que pode ser consultada de forma livre, mas que est√° limitada no que diz respeito √† a√ß√µes de inser√ß√£o de dados.</li>
                <li>Usadas para <b>otimiza√ß√£o</b> e para <b>seguran√ßa</b>.</li>
            </ul>
            <b>Exemplos:</b>
            <pre>
                CREATE VIEW TRABALHA_EM_1(pnome, fnome, fsobrenome, horas)
                AS SELECT PROJETO.nome, FUNCIONARIO.nome, sobrenome, horas
                    FROM FUNCIONARIO, PROJETO, TRABALHA_EM
                    WHERE ident = fident AND numero = pnumero;
                <hr>
                SELECT fnome, fsobrenome
                FROM TRABALHA_EM_1
                WHERE Pnome = 'Placa Verde';
                DROP VIEW TRABALHA_EM_1;
            </pre>
            <p>Os dados nas vis√µes devem estar sempre atualizados de acordo com os dados nas tabelas base.</p>
            <p>Os SGBDs precisam ser estudados para verificar como cada um trata dessa quest√£o.</p>

            <pre>
                CREATE VIEW DEPT_INFO (Dept_nome, No_of_funcs, Total_sal)
                AS SELECT DEPARTAMENTO.nome, COUNT (*), SUM (salario)
                FROM DEPARTMENTO, FUNCIONARIO
                WHERE numero = Dnumero
                GROUP BY DEPARTAMENTO.nome;
            </pre>
        </section>

        <section>
            <h2>Linguagem de consulta - SQL Parte IV.</h2>
            <p>Estes slides est√£o baseados na bibliografia:</p>
            <li>Elmasri, Ramez; Navathe, Shamkant B. Sistemas de Banco de Dados. Pearson, 6a edi√ß√£o, 808—Ä., 2011.</li>
        </section>
    </main>
    <footer>
        <p>Diego Serafim de Sousa - 13 de maio de 2024</p>
    </footer>
</body>
</html>
